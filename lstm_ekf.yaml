# Config file specifying application/domain specific commands and scripts
variables:
    solr-host: 
        - 127.0.0.1
    cassandra-host: 
        - 127.0.0.1
    application-host: 54.148.194.162
    db-host: 34.220.34.10
    search-host: 52.33.201.173
    lqn-model: '/home/ubuntu/woodside/lstm_ekf/testbed.lqn'
    solr-url: 'https://127.0.0.1:8983/solr'
    cassandra-home: '/home/ubuntu/woodside/apache-cassandra-3.11.2'

provision-cmds: 
    solr: "/<solr-url>/solr/admin/collections?action=ADDREPLICA&collection=items&shard=shard1&node=<solr-host>:9501_solr/"
    db: 
        - "sed -i 's/seeds:(.*)/seeds:$1, <cassandra-host>/' \"<cassandra-home>/conf/cassandra.yaml\""
        - "<cassandra-home>/bin/stop"
        - "<cassandra-home>/bin/start" 
        # Figure out how to use JMX rather than cassandra stop/start

deprovision-cmds: 
    solr-rem-node: "<solr-url>/solr/admin/collections?action=DELETEREPLICA&collection=items&shard=shard1&node=<solr-host>"
    db-rem-node: 
        - "sed -i 's/seeds:([^,]*,)([^,]*)$/seeds:$1/' \"<cassandra-home>/conf/cassandra.yaml\""
        - "<cassandra-home>/bin/stop"
        - "<cassandra-home>/bin/start"
        # Figure out how to use JMX rather than cassandra stop/start


search-endpoint: "http://<application-host>:8878/searchindex?q=*:*"

db-endpoint: "http://<application-host>:8878/fetch?q="

login-application: "ssh -i 'workkeypair.pem' ec2-user@<application-host>"

login-db: "ssh -i 'mykeypair1.pem' ec2-user@<db-host>"

login-search: "ssh -i 'workkeypair.pem' ec2-user@<search-host>"

activity-cmd: "python src/test_app.py"

lqn-tasks:
        - nApps: 1
        - dbTimeout: 1
        - ndbConn: 1
        - ndbQueries: 1
        - nDb: 1
        - nSearch: 1

lqn-thresholds: 
        - 0.9
        - 0.9
        - 0.9
        - 0.9
        - 0.9
        - 0.9

lqn-hosts:
        - "<application-host>"
        - "<application-host>"
        - "<application-host>"
        - "<application-host>"
        - "<db-host>"
        - "<search-host>"


lqn-provision-actions:
        - "/<solr-url>/solr/admin/collections?action=ADDREPLICA&collection=items&shard=shard1&node=<solr-host>:9501_solr/"
        -
            - "sed -i 's/seeds:(.*)/seeds:$1, <cassandra-host>/' \"<cassandra-home>/conf/cassandra.yaml\""
            - "<cassandra-home>/bin/stop"
            - "<cassandra-home>/bin/start" 
        # Figure out how to use JMX rather than cassandra stop/start
        - "curl http://<application-host>:8878/setdboptions?readtimeoutms=500000"
        - "curl http://<application-host>:8878/setdboptions?connsperhost=10000"
        - "curl http://<application-host>:8878/setdboptions?maxinflightqueries=10000"


lqn-deprovision-actions:
        - "<solr-url>/solr/admin/collections?action=DELETEREPLICA&collection=items&shard=shard1&node=<solr-host>"
        -
            - "sed -i 's/seeds:([^,]*,)([^,]*)$/seeds:$1/' \"<cassandra-home>/conf/cassandra.yaml\""
            - "<cassandra-home>/bin/stop"
            - "<cassandra-home>/bin/start" 
        # Figure out how to use JMX rather than cassandra stop/start
        - "curl http://<application-host>:8878/setdboptions?readtimeoutms=1000"
        - "curl http://<application-host>:8878/setdboptions?connsperhost=10"
        - "curl http://<application-host>:8878/setdboptions?maxinflightqueries=10"


model-update-cmd: "sed -i 's/<param0>\\s*=\\s*\\[?[0-9,]\\]?*/<param0> = <param1>/' <lqn-model>"

model-solve-cmd: "wine lqns <lqn-model>"
